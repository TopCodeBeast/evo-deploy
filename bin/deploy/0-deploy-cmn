#!/usr/bin/env bash

set -e

. $(PWD)/bin/init

SETTINGSREGISTRY=$(dappCreate common-contracts contracts/SettingsRegistry.sol:SettingsRegistry)

# INTERSTELLARENCODERV4 
CHAIN_ID=3
LAND_ID=3
INTERSTELLARENCODERV4=$(dappCreate common-contracts contracts/InterstellarEncoderV4.sol:InterstellarEncoderV4 3 3)

interstellarEncoderId=$(seth --to-bytes32 $(seth --from-ascii "CONTRACT_INTERSTELLAR_ENCODER"))
seth send $SETTINGSREGISTRY "setAddressProperty(bytes32,address)" $interstellarEncoderId $INTERSTELLARENCODERV4 

# OBJECTOWNERSHIP 
OBJECTOWNERSHIP=$(dappCreate common-contracts contracts/ObjectOwnershipV2.sol:ObjectOwnershipV2)
OBJECTOWNERSHIP_PROXY=$(dappProxy src/proxy/ObjectOwnerShipProxy.sol:ObjectOwnerShipProxy)

seth send $OBJECTOWNERSHIP_PROXY "upgradeTo(address)" $OBJECTOWNERSHIP
seth send $OBJECTOWNERSHIP_PROXY "initializeContract(address)" $SETTINGSREGISTRY
info "ObjectOwnerShipV2Proxy inited."

objectOwnershipId=$(seth --to-bytes32 $(seth --from-ascii "CONTRACT_OBJECT_OWNERSHIP"))
seth send $SETTINGSREGISTRY "setAddressProperty(bytes32,address)" $objectOwnershipId $OBJECTOWNERSHIP_PROXY 

## TODO::CHECK
seth send $INTERSTELLARENCODERV4 "registerNewOwnershipContract(address,uint8)" $OBJECTOWNERSHIP_PROXY $(seth --to-hex 1) 

# TokenLocation
TOKENLOCATION=$(dappCreate common-contracts contracts/TokenLocation.sol:TokenLocation)

TOKENLOCATION_PROXY=$(dappProxy src/proxy/TokenLocationProxy.sol:TokenLocationProxy)

seth send $TOKENLOCATION_PROXY "upgradeTo(address)" $TOKENLOCATION  
seth send $TOKENLOCATION_PROXY "initializeContract()" 
info "TokenLocationProxy inited."

tokenLocationId=$(seth --to-bytes32 $(seth --from-ascii "CONTRACT_TOKEN_LOCATION"))
seth send $SETTINGSREGISTRY "setAddressProperty(bytes32,address)" $tokenLocationId $TOKENLOCATION_PROXY 

# TokenUse
TOKENUSE=$(dappCreate common-contracts contracts/TokenUse.sol:TokenUse)

TOKENUSE_PROXY=$(dappProxy src/proxy/TokenUseProxy.sol:TokenUseProxy)

seth send $TOKENUSE_PROXY "upgradeTo(address)" $TOKENUSE  
seth send $TOKENUSE_PROXY "initializeContract(address)" $SETTINGSREGISTRY
info "TokenUseProxy inited."

tokenUseId=$(seth --to-bytes32 $(seth --from-ascii "CONTRACT_TOKEN_USE"))
seth send $SETTINGSREGISTRY "setAddressProperty(bytes32,address)" $tokenUseId $TOKENUSE_PROXY 

# UserPoints 
USERPOINTS=$(dappCreate common-contracts contracts/UserPoints.sol:UserPoints)

USERPOINTS_PROXY=$(dappProxy src/proxy/UserPointsProxy.sol:UserPointsProxy)

seth send $USERPOINTS_PROXY "upgradeTo(address)" $USERPOINTS  
seth send $USERPOINTS_PROXY "initializeContract()" 
info "UserPointsProxy inited."

userPointsId=$(seth --to-bytes32 $(seth --from-ascii "CONTRACT_USER_POINTS"))
seth send $SETTINGSREGISTRY "setAddressProperty(bytes32,address)" $userPointsId $USERPOINTS_PROXY 

