#!/usr/bin/env bash

set -e

. $(PWD)/bin/init

tokens=("GOLD" "WOOD" "HHO" "FIRE" "SIOO" "RING" "KTON")

for token in "${tokens[@]}"; do
    address=$(dappCreate token-contracts "src/${token}.sol:${token}")
    setting=$token
    if [[ "$setting" = "HHO" ]]; then
      setting="WATER"
    fi
    if [[ "$setting" = "SIOO" ]]; then
      setting="SOIL"
    fi
    addAddress "TOKEN_ERC20_$setting" "$address"
    id="CONTRACT_${setting}_ERC20_TOKEN"
    id=$(seth --to-bytes32 $(seth --to-hex $(seth --from-ascii $id)))
    seth send $SETTINGSREGISTRY "setAddressProperty(bytes32,address)" $id $address 
    if test $(seth call $SETTINGSREGISTRY "addressOf(bytes32)(address)" $id) != $address; then
      (echo "check register ${registry} failed."; exit 1;)
    fi
done
