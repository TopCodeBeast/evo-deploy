#!/usr/bin/env bash

set -e

. $(PWD)/bin/init

# TokenLocationAuthority
wards=$(loadAuthConf ".common.tokenLocation.wards | .[]")
sigs=$(loadAuthConf ".common.tokenLocation.sigs | .[]")
TOKENLOCATION_AUTHORITY=$(dappAuth "TokenLocation" common-contracts Authority "$wards" "$sigs" )
seth send $TOKENLOCATION_PROXY "setAuthority(address)" $TOKENLOCATION_AUTHORITY

# TokenUseAuthority
wards=$(loadAuthConf ".common.tokenUse.wards | .[]")
sigs=$(loadAuthConf ".common.tokenUse.sigs | .[]")
TOKENUSE_AUTHORITY=$(dappAuth "TokenUse" common-contracts Authority "$wards" "$sigs")
seth send $TOKENUSE_PROXY "setAuthority(address)" $TOKENUSE_AUTHORITY

# MintAndBurnAuthority
wards=$(loadAuthConf ".common.mintAndBurn.wards | .[]")
sigs=$(loadAuthConf ".common.mintAndBurn.sigs | .[]")
MINTANDBURN_AUTHORITY_ELEMENT=$(dappAuth "MintAndBurn" common-contracts Authority "$wards" "$sigs")

seth send $TOKEN_ERC20_GOLD "setAuthority(address)" $MINTANDBURN_AUTHORITY_ELEMENT
seth send $TOKEN_ERC20_WOOD "setAuthority(address)" $MINTANDBURN_AUTHORITY_ELEMENT
seth send $TOKEN_ERC20_WATER "setAuthority(address)" $MINTANDBURN_AUTHORITY_ELEMENT
seth send $TOKEN_ERC20_FIRE "setAuthority(address)" $MINTANDBURN_AUTHORITY_ELEMENT
seth send $TOKEN_ERC20_SOIL "setAuthority(address)" $MINTANDBURN_AUTHORITY_ELEMENT

# # ClockAuctionAuthority
wards=$(loadAuthConf ".apostle.clockAuction.wards | .[]")
sigs=$(loadAuthConf ".apostle.clockAuction.sigs | .[]")
CLOCKAUCTION_AUTHORITY_APOSTLE=$(dappAuth "ApostleClockAuction" common-contracts Authority "$wards" "$sigs")
seth send $APOSTLECLOCKAUCTION_PROXY "setAuthority(address)" $CLOCKAUCTION_AUTHORITY_APOSTLE

# ApostleBaseAuthorityV2
# Pet
# APOSTLEBASEV2_AUTHORITY=$(dapp create ApostleBaseAuthorityV2 [$GEN0APOSTLE_PROXY,$SIRINGCLOCKAUCTION_PROXY,$PETBASE_PROXY,$TOKENUSE_PROXY])
wards=$(loadAuthConf ".apostle.base.wards | .[]")
sigs=$(loadAuthConf ".apostle.base.sigs | .[]")
APOSTLEBASEV2_AUTHORITY=$(dappAuth "ApostleBase" common-contracts Authority "$wards" "$sigs")
seth send $APOSTLEBASE_PROXY "setAuthority(address)" $APOSTLEBASEV2_AUTHORITY

# UserPointsAuthority
wards=$(loadAuthConf ".common.userPoints.wards | .[]")
sigs=$(loadAuthConf ".common.userPoints.sigs | .[]")
USERPOINTS_AUTHORITY=$(dappAuth "UserPoints" common-contracts Authority "$wards" "$sigs")
seth send $USERPOINTS_PROXY "setAuthority(address)" $USERPOINTS_AUTHORITY

# LandBaseAuthority
operator=$(loadConf ".land.operator")
wards=$(loadAuthConf ".land.base.wards | .[]")
sigs=$(loadAuthConf ".land.base.sigs | .[]")
LANDBASE_AUTHORITY=$(dappAuth "LandBase" common-contracts Authority "$wards" "$sigs")
seth send $LANDBASEAUTHORITY "rely(address)" "$operator"
seth send $LANDBASE_PROXY "setAuthority(address)" $LANDBASE_AUTHORITY

# BancorExchangeAuthority
# BANCOREXCHANGE_AUTHORITY=$(dapp create BancorExchangeAuthority [$CLOCKAUCTION_PROXY])
# seth send $BANCOREXCHANGE "setAuthority(address)" $BANCOREXCHANGE_AUTHORITY

# ClockAuctionAuthority
wards=$(loadAuthConf ".market.clockAuction.wards | .[]")
sigs=$(loadAuthConf ".market.clockAuction.sigs | .[]")
CLOCKAUCTION_AUTHORITY_MARKET=$(dappAuth "LandClockAuction" common-contracts Authority "$wards" "$sigs")
seth send $CLOCKAUCTION_PROXY "setAuthority(address)" $CLOCKAUCTION_AUTHORITY_MARKET

# # UserRolesAuthority
# USERROLES_AUTHORITY=$(dapp create UserRolesAuthority [$ROLESUPDATER])
# addAddress "USERROLES_AUTHORITY" "$USERROLES_AUTHORITY"
# seth send $USERROLES_PROXY "setAuthority(address)" $USERROLES_AUTHORITY

# MintAndBurnAuthority-kton
# MINTANDBURN_AUTHORITY_KTON=$(dapp create MintAndBurnAuthority [$GRINGOTTSBANK_PROXY,$DIVIDENDPOOL_PROXY])
# addAddress "MINTANDBURN_AUTHORITY_KTON" "$MINTANDBURN_AUTHORITY_KTON"
# seth send $TOKEN_ERC20_KTON "setAuthority(address)" $MINTANDBURN_AUTHORITY_KTON

# ObjectOwnershipAuthorityV2
# Pet
# OBJECTOWNERSHIPV2_AUTHORITY=$(dapp create src/common-contracts/ObjectOwnershipAuthorityV2.f.sol:ObjectOwnershipAuthorityV2 [$LANDBASE_PROXY,$APOSTLEBASE_PROXY,$ERC721BRIDGE_PROXY])
# addAddress "OBJECTOWNERSHIPV2_AUTHORITY" "$OBJECTOWNERSHIPV2_AUTHORITY"
# seth send $OBJECTOWNERSHIP_PROXY "setAuthority(address)" $OBJECTOWNERSHIPV2_AUTHORITY 

# Pet
# # ERC721AdaptorAuthority
# ERC721ADAPTOR_AUTHORITY=$(dapp create src/common-contracts/ERC721AdaptorAuthority.f.sol:ERC721AdaptorAuthority [$ERC721BRIDGE_PROXY])
# addAddress "ERC721ADAPTOR_AUTHORITY" "$ERC721ADAPTOR_AUTHORITY"
# seth send $ERC721ADAPTOR_PROXY "setAuthority(address)" $ERC721ADAPTOR_AUTHORITY 

# # ERC721BridgeAuthority
# ERC721BRIDGE_AUTHORITY=$(dapp create src/apostle/ERC721BridgeAuthority.f.sol:ERC721BridgeAuthority [$PETBASE_PROXY])
# addAddress "ERC721BRIDGE_AUTHORITY" "$ERC721BRIDGE_AUTHORITY"
# seth send $ERC721BRIDGE_PROXY "setAuthority(address)" $ERC721BRIDGE_AUTHORITY 


# MysteriousTreasure
wards=$(loadAuthConf ".land.mysteriousTreasure.wards | .[]")
sigs=$(loadAuthConf ".land.mysteriousTreasure.sigs | .[]")
MYSTERIOUSTREASURE_AUTHORITY=$(dappAuth "MysteriousTreasure" common-contracts Authority "$wards" "$sigs")
seth send $MYSTERIOUSTREASURE_PROXY "setAuthority(address)" $MYSTERIOUSTREASURE_AUTHORITY


# # LandResourceAuthority
wards=$(loadAuthConf ".land.resource.wards | .[]")
sigs=$(loadAuthConf ".land.resource.sigs | .[]")
LANDRESOURCE_AUTHORITY=$(dappAuth "LandResource" common-contracts Authority "$wards" "$sigs")
seth send $LANDRESOURCE_PROXY "setAuthority(address)" $LANDRESOURCE_AUTHORITY


